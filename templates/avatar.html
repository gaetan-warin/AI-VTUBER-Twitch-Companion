<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI CHAT BOT</title>
    <link rel="icon" href="static/favicon.ico" type="image/x-icon">

    <script src="static/js/dep/jquery-3.7.1.min.js"></script>
    <script src="static/js/dep/live2dcubismcore.min.js"></script>
    <script src="static/js/dep/live2d.min.js"></script>
    <script src="static/js/dep/pixi.min.js"></script>
    <script src="static/js/dep/pixi-live2d-display.js"></script>

    <script src="static/js/dep/gsap.min.js"></script>
    <script src="static/js/dep/socket.io.min.js"></script>
    <script src="static/js/dep/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <audio id="microphoneAudio" autoplay></audio>
    <canvas id="canvas"></canvas>
    <div id="speech-bubble" class="speech-bubble"></div>
    <div id="question-display" class="question-display" style="display: none;"></div>
    <div id="notification" class="notification"></div>

    <div class="controls">
        <div class="input-group">
            <textarea id="makeItSpeak" placeholder="Enter text for the avatar to speak or ask AI..."></textarea>
            <div class="button-group">
                <button id="speakBtn">Speak</button>
                <button id="askAIBtn">Ask AI</button>
            </div>
        </div>
    </div>

    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Configuration</h2>
            <button id="toggleSidebarBtn">Collapse</button>
        </div>
        <div class="sidebar-tabs">
            <button class="tab-button active" data-tab="general">General</button>
            <button class="tab-button" data-tab="technical">Technical</button>
        </div>
        <div class="sidebar-content">
            <div class="tab-content" id="general" style="display: block;">
                <div class="settings-container">
                    <label for="avatarModel">Avatar Model:</label>
                    <select id="avatarModel"></select>
                    <label for="backgroundImage">Background Image:</label>
                    <select id="backgroundImage"></select>
                    <label for="personaName">Persona Name:</label>
                    <input type="text" id="personaName" value="Sarah">
                    <label for="personaRole">Persona Role:</label>
                    <textarea id="personaRole">Virtual assistant providing calm and engaging interactions.</textarea>
                    <label for="prePrompt">Pre Prompt:</label>
                    <textarea id="prePrompt">Please respond concisely and avoid monologues. Ensure your behavior strictly adheres to Twitch's Terms of Service, Community Guidelines, and Developer Agreement. Filter out prohibited content (hate speech, threats, etc.), promote respectful interactions, avoid illegal or harmful activities, prevent spam, respect user privacy, and always identify yourself as a bot. Follow channel-specific rules, provide neutral responses when unsure, and be updated regularly to comply with any changes in Twitch's policies.</textarea>
                </div>
            </div>
            <div class="tab-content" id="technical" style="display: none;">
                <div class="settings-container">
                    <div class="settings-section">
                        <h3>Speech Input</h3>
                        <div class="microphone-overlay" id="microphoneOverlay">
                            <p>Microphone access is required for this feature</p>
                            <button id="requestMicrophoneAccess">Allow Microphone Access</button>
                        </div>
                        <div class="settings-group">
                            <label for="currentMicrophone">Current Microphone:</label>
                            <input type="text" id="currentMicrophone" readonly>
                        </div>
                        <p class="microphone-instructions">To change:
                            <br>1. Select the microphone you want as the default in your browser or system.
                            <br>2. Restart the browser (or reload the page) to apply changes.
                        </p>
                        <button id="startRecordingBtn">Start Recording</button>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="waveToggle" checked>
                            <label for="waveToggle">Show Wave Animation</label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>AI Settings</h3>
                        <label for="ollamaModel">Ollama Model:</label>
                        <select id="ollamaModel"></select>
                    </div>

                    <div class="settings-section">
                        <h3>Twitch Listener</h3>
                        <div class="button-group-inline">
                            <button id="startListenerBtn">Start Listener</button>
                            <button id="stopListenerBtn">Stop Listener</button>
                        </div>
                        <button id="configBtn">Config</button>
                        <div id="listenerStatus" class="status-indicator">Status: <span id="listenerStatusText">Stopped</span></div>
                    </div>

                </div>
            </div>
            <div class="save-button-container">
                <button id="saveConfigBtn">Save Configuration</button>
            </div>
        </div>
    </div>

    <button id="toggleSidebarBtnCollapsed" class="toggle-sidebar-btn-collapsed">
        <img src="static/images/expand-icon.webp" alt="Expand">
    </button>

    <!-- Popup Modal -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Edit Configuration</h2>
            <div class="settings-section">
                <h3>Bot Behavior</h3>
                <label for="extraDelayListener">Extra Delay Listener:</label>
                <input type="number" id="extraDelayListener" value="3" step="0.5">
                <label for="nbSpamMessage">Spam Time Window:</label>
                <input type="number" id="nbSpamMessage" value="3" step="0.5">
            </div>
            <div class="settings-section">
                <h3>Follow/Sub Settings</h3>
                <label for="botNameFollowSub">Follow/Sub Bot Name:</label>
                <input type="text" id="botNameFollowSub" value="wizebot">
                <label for="keyWordFollow">Follow Keyword:</label>
                <input type="text" id="keyWordFollow" value="New FOLLOW(S)">
                <label for="keyWordSub">Sub Keyword:</label>
                <input type="text" id="keyWordSub" value="NEW SUB">
                <label for="delimiterName">Name Delimiter Start:</label>
                <input type="text" id="delimiterName" value="{">
                <label for="delimiterNameEnd">Name Delimiter End:</label>
                <input type="text" id="delimiterNameEnd" value="}">
            </div>
            <div class="settings-section">
                <h3>Twitch Connection</h3>
                <label for="channelName">Channel Name:</label>
                <input type="text" id="channelName" value="ai_chat_bot">
                <label for="twitchToken">Twitch Token:</label>
                <input type="text" id="twitchToken" class="blurry" value="jfitp4b4e94wdl6t087qesvacbr0ad">
                <label for="clientId">Twitch Client ID:</label>
                <input type="text" id="clientId" class="blurry" value="gp762nuuoqcoxypju8c569th9wz7q5">
            </div>
            <button id="saveModalConfigBtn">ok</button>
        </div>
    </div>

    <div class="wrap">
        <canvas id="waveCanvas" width="1000" height="100"></canvas>
    </div>

    <script type="module" src="static/js/main.js"></script>
</body>
</html>